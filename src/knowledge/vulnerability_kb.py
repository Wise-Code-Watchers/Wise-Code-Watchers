from src.knowledge.base import KnowledgeBase, KnowledgeEntry


class VulnerabilityKB(KnowledgeBase):
    def _load_entries(self):
        self.entries = [
            KnowledgeEntry(
                id="vuln001",
                category="injection",
                title="SQL Injection",
                description="User input directly concatenated into SQL queries without sanitization",
                pattern=r"(?:execute|query)\s*\(\s*['\"].*%s.*['\"].*%.*\)",
                severity="critical",
                tags=["sql-injection", "injection", "database"],
            ),
            KnowledgeEntry(
                id="vuln002",
                category="injection",
                title="Command Injection",
                description="User input passed to shell commands without proper sanitization",
                pattern=r"(?:os\.system|subprocess\.call|subprocess\.run)\s*\(.*\+.*\)",
                severity="critical",
                tags=["command-injection", "injection", "shell"],
            ),
            KnowledgeEntry(
                id="vuln003",
                category="authentication",
                title="Hardcoded Credentials",
                description="Passwords, API keys, or secrets hardcoded in source code",
                pattern=r"(?:password|api_key|secret|token)\s*=\s*['\"][^'\"]{8,}['\"]",
                severity="critical",
                tags=["hardcoded-credentials", "secrets", "authentication"],
            ),
            KnowledgeEntry(
                id="vuln004",
                category="crypto",
                title="Weak Cryptographic Algorithm",
                description="Use of deprecated or weak cryptographic algorithms (MD5, SHA1, DES)",
                pattern=r"(?:hashlib\.md5|hashlib\.sha1|DES|RC4)",
                severity="high",
                tags=["weak-crypto", "cryptography", "hashing"],
            ),
            KnowledgeEntry(
                id="vuln005",
                category="xss",
                title="Cross-Site Scripting (XSS)",
                description="User input rendered in HTML without proper escaping",
                pattern=r"(?:innerHTML|document\.write)\s*=.*\+",
                severity="high",
                tags=["xss", "injection", "frontend"],
            ),
            KnowledgeEntry(
                id="vuln006",
                category="path_traversal",
                title="Path Traversal",
                description="User input used in file paths without validation",
                pattern=r"(?:open|read|write)\s*\(.*\+.*\)",
                severity="high",
                tags=["path-traversal", "file-access", "injection"],
            ),
            KnowledgeEntry(
                id="vuln007",
                category="authentication",
                title="Missing Authentication",
                description="Sensitive endpoints or functions without proper authentication checks",
                severity="high",
                tags=["authentication", "authorization", "access-control"],
            ),
            KnowledgeEntry(
                id="vuln008",
                category="data_exposure",
                title="Sensitive Data Logging",
                description="Logging of sensitive information like passwords, tokens, or PII",
                pattern=r"(?:log|print|console\.log).*(?:password|token|secret|ssn|credit)",
                severity="high",
                tags=["data-exposure", "logging", "privacy"],
            ),
            KnowledgeEntry(
                id="vuln009",
                category="deserialization",
                title="Unsafe Deserialization",
                description="Using pickle or other unsafe deserialization on untrusted data",
                pattern=r"pickle\.loads?\s*\(",
                severity="critical",
                tags=["deserialization", "pickle", "rce"],
            ),
            KnowledgeEntry(
                id="vuln010",
                category="ssl",
                title="SSL/TLS Verification Disabled",
                description="Disabling SSL certificate verification",
                pattern=r"verify\s*=\s*False",
                severity="high",
                tags=["ssl", "tls", "certificate", "mitm"],
            ),
            KnowledgeEntry(
                id="vuln011",
                category="race_condition",
                title="Race Condition",
                description="Time-of-check to time-of-use (TOCTOU) vulnerabilities",
                severity="medium",
                tags=["race-condition", "toctou", "concurrency"],
            ),
            KnowledgeEntry(
                id="vuln012",
                category="buffer",
                title="Buffer Overflow",
                description="Writing beyond buffer boundaries in unsafe languages",
                severity="critical",
                tags=["buffer-overflow", "memory", "c", "cpp"],
            ),
        ]
