rules:
  - id: rb-exception-handling-around-{{SYMBOL}}
    languages: [ruby]
    severity: WARNING
    message: "Call to {{SYMBOL}} without surrounding begin/rescue"
    patterns:
      - pattern: "{{SYMBOL}}(...)"
      - pattern-not-inside: |
          begin
            ...
          rescue
            ...
          end

  - id: rb-rescue-all
    languages: [ruby]
    severity: WARNING
    message: "Bare rescue catches all exceptions including system errors"
    patterns:
      - pattern: |
          begin
            ...
          rescue
            ...
          end
      - pattern-not: |
          begin
            ...
          rescue $EXCEPTION
            ...
          end

  - id: rb-ensure-cleanup-{{SYMBOL}}
    languages: [ruby]
    severity: INFO
    message: "Ensure block with {{SYMBOL}} cleanup"
    patterns:
      - pattern: |
          begin
            ...
          ensure
            ...
            {{SYMBOL}}(...)
            ...
          end
